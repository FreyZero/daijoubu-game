import{e as F,v as r,j as C,H as K,a4 as O,c as o,o as n,N as g,a as l,t as c,L as P,F as Q,Q as J,K as X,d as Z,a6 as ee,_ as L,b as te,w as se,y as le}from"./cvlhs-y4.js";import{_ as ae}from"./BDUOyUbU.js";const ne={class:"round-container"},oe={key:0,class:"card"},ie={key:1,class:"card error"},ue={key:2,class:"card"},re={class:"header"},ce=["disabled"],de={class:"synopsis"},ve={class:"synopsis-text"},me={class:"hints"},pe={key:0},_e={key:1},fe={key:2},ye={key:3},he=["src"],ge={class:"options"},ke=["onClick"],be={key:0,class:"result"},we={key:0,class:"ok"},xe={key:1,class:"bad"},Ce=["src"],$e=F({__name:"AnimeGuessRound",emits:["result"],setup(q,{emit:k}){const b=k,y=r(!0),v=r(null),m=r(null),S=r([]),f=r(""),i=r(null),h=r(-1),u=r(0),w=C(()=>{var t,s,a,d,p,_,R,A;const e=m.value;return e&&(((s=(t=e.images)==null?void 0:t.jpg)==null?void 0:s.large_image_url)||((d=(a=e.images)==null?void 0:a.webp)==null?void 0:d.large_image_url)||((_=(p=e.images)==null?void 0:p.jpg)==null?void 0:_.large_large_image_url)||((A=(R=e.images)==null?void 0:R.webp)==null?void 0:A.large_large_image_url))||""}),$=e=>{var t,s,a,d;return((t=e.title_english)==null?void 0:t.trim())||((s=e.title)==null?void 0:s.trim())||((a=e.title_japanese)==null?void 0:a.trim())||((d=e.title)==null?void 0:d.trim())||"Unknown"},x=e=>e.toLowerCase().replace(/\s+/g," ").trim();function H(e,t){if(!e)return"";const s=Array.from(new Set(t.split(/[\s:;,.!?()\-]+/).filter(Boolean)));let a=e;for(const d of s){const p=new RegExp(d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");a=a.replace(p,"█".repeat(Math.min(d.length,6)))}return a}const V=C(()=>{var a;const e=((a=m.value)==null?void 0:a.synopsis)||"",t=f.value||"",s=H(e,t);return s.length>280?s.slice(0,280)+"…":s}),z=C(()=>{var e;return i.value!==null?((e=m.value)==null?void 0:e.synopsis)||"":V.value}),D=C(()=>i.value!==null?0:Math.max(12-u.value*4,0)),j=C(()=>{var e,t,s;return((s=(t=(e=m.value)==null?void 0:e.studios)==null?void 0:t[0])==null?void 0:s.name)||"Unknown"}),M=C(()=>{const e=m.value;return[e!=null&&e.type?`Type: ${e.type}`:null,e!=null&&e.year?`Year: ${e.year}`:null,(e==null?void 0:e.episodes)!=null?`Episodes: ${e.episodes}`:null,j.value?`Studio: ${j.value}`:null].filter(Boolean)});function G(e){const t=e.slice();for(let s=t.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[t[s],t[a]]=[t[a],t[s]]}return t}async function E(e=4){for(let s=0;s<e;s++){const a=1+Math.floor(Math.random()*8),p=(await $fetch("https://api.jikan.moe/v4/top/anime",{query:{filter:"bypopularity",page:a,limit:25}})).data.filter(_=>{var A;return $(_)&&(((A=_.synopsis)==null?void 0:A.length)??0)>=50});if(p.length)return p[Math.floor(Math.random()*p.length)]}return(await $fetch("https://api.jikan.moe/v4/top/anime",{query:{filter:"bypopularity",page:1,limit:25}})).data[0]}async function I(e){const t=x(e),s=1+Math.floor(Math.random()*8),d=(await $fetch("https://api.jikan.moe/v4/top/anime",{query:{filter:"bypopularity",limit:25,page:s}})).data.map($).filter(_=>_&&x(_)!==t),p=Array.from(new Set(d.map(x))).map(_=>d.find(R=>x(R)===_));return G(p).slice(0,3)}async function B(){try{y.value=!0,v.value=null,i.value=null,u.value=0;const e=await E();m.value=e,f.value=$(e);let t=await I(f.value);for(;t.length<3;){const a=await I(f.value);t=Array.from(new Set([...t,...a]))}const s=G([f.value,...t.slice(0,3)]);S.value=s,h.value=s.findIndex(a=>x(a)===x(f.value))}catch{v.value="Failed to load a round. You can retry."}finally{y.value=!1}}function U(e){if(i.value!==null)return;i.value=e;const t=e===h.value;u.value=3,b("result",t)}function W(){i.value===null&&(u.value=Math.min(u.value+1,3))}function Y(){B()}const T=r(!1);K(()=>i.value,e=>{e!==null&&(T.value=!0)});const N=()=>{T.value=!1};return O(B),(e,t)=>(n(),o("div",ne,[y.value?(n(),o("div",oe,t[0]||(t[0]=[l("div",{class:"skeleton title"},null,-1),l("div",{class:"skeleton lines"},null,-1),l("div",{class:"skeleton image"},null,-1),l("div",{class:"skeleton options"},null,-1)]))):v.value?(n(),o("div",ie,[l("div",null,c(v.value),1),l("button",{class:"btn",onClick:Y},"Try Again")])):(n(),o("div",ue,[l("div",re,[t[1]||(t[1]=l("h2",null,"Which anime is this?",-1)),l("button",{class:"btn-hint",disabled:i.value!==null,onClick:W}," Reveal Hint ("+c(3-u.value)+" left) ",9,ce)]),l("div",de,[t[2]||(t[2]=l("strong",null,"Synopsis:",-1)),l("div",ve,c(z.value),1)]),l("ul",me,[u.value>=1?(n(),o("li",pe,c(M.value[0]),1)):g("",!0),u.value>=2?(n(),o("li",_e,c(M.value[1]),1)):g("",!0),u.value>=3?(n(),o("li",fe,c(M.value[2]),1)):g("",!0),u.value>=3&&M.value[3]?(n(),o("li",ye,c(M.value[3]),1)):g("",!0)]),l("div",{class:"image-wrap",style:P({filter:`blur(${D.value}px)`})},[w.value?(n(),o("img",{key:0,src:w.value,alt:"Anime image"},null,8,he)):g("",!0)],4),l("div",ge,[(n(!0),o(Q,null,J(S.value,(s,a)=>(n(),o("button",{key:a,class:X(["opt",{correct:i.value!==null&&a===h.value,wrong:i.value===a&&a!==h.value}]),onClick:d=>U(a)},c(s),11,ke))),128))]),i.value!==null?(n(),o("div",be,[i.value===h.value?(n(),o("div",we,"Correct!")):(n(),o("div",xe,[t[3]||(t[3]=Z("Wrong — it was: ")),l("strong",null,c(f.value),1)]))])):g("",!0)])),T.value&&w.value?(n(),o("div",{key:3,class:"img-modal",onClick:ee(N,["self"])},[l("button",{class:"img-modal-close",onClick:N,"aria-label":"Close"},"×"),l("img",{src:w.value,alt:"Anime image full",class:"img-modal-content"},null,8,Ce)])):g("",!0)]))}}),Me=L($e,[["__scopeId","data-v-474498bb"]]),Re={class:"page-wrapper",style:{"max-width":"960px",margin:"0 auto"}},Ae={class:"mb-4",style:{display:"flex",gap:"1rem","align-items":"center"}},Se={class:"mt-6",style:{display:"flex",gap:"0.75rem"}},Te=["disabled"],je={key:0,class:"mt-6 p-4 rounded",style:{background:"#f1f5f9"}},Ge=F({__name:"anime-guess",setup(q){const k=r(10),b=r(0),y=r(0),v=r(!1),m=r(0),S=h=>{v.value||(v.value=!0,b.value+=1,h&&(y.value+=1))},f=()=>{v.value&&(v.value=!1,m.value+=1)},i=()=>{k.value=10,b.value=0,y.value=0,v.value=!1,m.value+=1};return(h,u)=>{const w=Me,$=ae;return n(),o("div",Re,[u[1]||(u[1]=l("h1",{class:"text-3xl font-bold mb-4"},"Guess the Anime",-1)),l("div",Ae,[l("div",null,"Score: "+c(y.value)+" / "+c(b.value),1),l("div",null,"Target Rounds: "+c(k.value),1)]),te($,null,{default:se(()=>[(n(),le(w,{key:m.value,onResult:S}))]),_:1}),l("div",Se,[l("button",{class:"btn",disabled:!v.value||b.value>=k.value,onClick:f}," Next Round ",8,Te),l("button",{class:"btn-outline",onClick:i},"Reset Game")]),b.value>=k.value?(n(),o("div",je,[u[0]||(u[0]=l("strong",null,"Game over!",-1)),l("div",null,"Your final score: "+c(y.value)+" / "+c(k.value),1),l("div",{class:"mt-2"},[l("button",{class:"btn",onClick:i},"Play Again")])])):g("",!0)])}}}),Ne=L(Ge,[["__scopeId","data-v-4a5fa645"]]);export{Ne as default};
