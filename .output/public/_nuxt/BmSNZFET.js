import{e as ne,v,j as L,T as me,Q as pe,ad as ye,c as u,o as r,ab as Y,Y as M,ac as he,a as o,t as _,d as F,F as b,$ as C,V as R,n as _e,ae as ge,_ as le,b as ke,af as te,w as we,y as be}from"./DIYasLGD.js";import{_ as Ce}from"./DKw8WjJw.js";const Ae={key:0,class:"card"},$e={key:1,class:"card error"},Ee={key:2,class:"card"},Te={class:"top"},xe={class:"mode"},Ne={style:{"text-transform":"capitalize"}},Se={class:"len"},Be={key:0,class:"image-wrap"},Le=["src"],Me={class:"board"},Re={class:"keyboard"},Ke=["onClick"],Fe=["onClick"],Ve=["onClick"],De={key:1,class:"hints"},Ue={key:2,class:"result"},ze={key:0,class:"ok"},Pe={key:1,class:"bad"},je=["src"],K=6,Ge=ne({__name:"AnimedleGame",props:{mode:{}},setup(H){const f=H,A=v(!0),g=v(null),x=v(""),d=v(""),m=v(null),y=v([]),p=v(0),V=v([]),k=v({}),w=v(!1),N=v(!1),D=v(0),I=v(null),E=v("");function U(){requestAnimationFrame(()=>{var e;return(e=I.value)==null?void 0:e.focus()})}function ae(e){P(e),e.preventDefault(),e.stopPropagation(),E.value=""}function se(){const e=E.value.slice(-1).toUpperCase();/^[A-Z]$/.test(e)&&h(e),E.value=""}const oe="QWERTYUIOP ASDFGHJKL ZXCVBNM".split(" "),S=L(()=>D.value),$=L(()=>d.value.length);function z(e){var t,l,a,i;return((t=e.title_english)==null?void 0:t.trim())||((l=e.title)==null?void 0:l.trim())||((a=e.title_japanese)==null?void 0:a.trim())||((i=e.title)==null?void 0:i.trim())||""}function O(e){var t,l,a,i;return((t=e==null?void 0:e.jpg)==null?void 0:t.large_image_url)||((l=e==null?void 0:e.webp)==null?void 0:l.large_image_url)||((a=e==null?void 0:e.jpg)==null?void 0:a.large_large_image_url)||((i=e==null?void 0:e.webp)==null?void 0:i.large_large_image_url)||null}function B(e){return(e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/[A-Za-z]/g)||[]).join("").toUpperCase()}function ie(e){y.value=Array.from({length:K},()=>""),V.value=Array.from({length:K},()=>Array.from({length:e},()=>"")),D.value=0,p.value=0,k.value={},w.value=!1,N.value=!1}function re(e,t){const l=Array(t.length).fill("absent"),a=t.split(""),i=e.split(""),c={};for(const n of a)c[n]=(c[n]||0)+1;for(let n=0;n<a.length;n++)i[n]===a[n]&&(l[n]="correct",c[i[n]]--,i[n]="*");for(let n=0;n<a.length;n++){if(l[n]==="correct")continue;const s=i[n];s&&c[s]>0?(l[n]="present",c[s]--):l[n]="absent"}return l}function ue(e,t){for(let l=0;l<e.length;l++){const a=e[l],i=t[l],c=k.value[a];c?(c==="present"&&i==="correct"&&(k.value[a]="correct"),c==="absent"&&(i==="present"||i==="correct")&&(k.value[a]=i)):k.value[a]=i}}function h(e){if(!(w.value||!d.value)){if(e==="ENTER"){ce();return}if(e==="BACKSPACE"){if(p.value>0){const t=S.value,l=y.value[t]||"";y.value[t]=l.slice(0,-1),p.value--}return}if(/^[A-Z]$/.test(e)&&p.value<$.value){const t=S.value,l=y.value[t]||"";y.value[t]=(l+e).slice(0,$.value),p.value++}}}function ce(){if(w.value)return;const e=S.value,t=y.value[e]||"";if(t.length!==$.value)return;const l=re(t,d.value);if(V.value[e]=l,ue(t,l),t===d.value){N.value=!0,w.value=!0;return}if(e+1>=K){w.value=!0;return}D.value=e+1,p.value=0}function P(e){e.key==="Enter"?h("ENTER"):e.key==="Backspace"?h("BACKSPACE"):/^[a-z]$/i.test(e.key)&&h(e.key.toUpperCase())}const de=L(()=>{const e=S.value;return N.value||w.value||e>=5?3:e>=4?2:e>=2?1:0}),W=L(()=>{const e=m.value||{},t=[];return f.mode==="anime"?(e.type&&t.push(`Type: ${e.type}`),e.year&&t.push(`Year: ${e.year}`),e.studio&&t.push(`Studio: ${e.studio}`),e.synopsis&&t.push(`Synopsis: ${e.synopsis.slice(0,160)}…`)):(e.animeTitle&&t.push(`Anime: ${e.animeTitle}`),e.year&&t.push(`Anime Year: ${e.year}`),e.type&&t.push(`Anime Type: ${e.type}`)),t.slice(0,de.value)}),Z=[];let Q=!1;async function q(){if(Q)return;const e=Array.from({length:8},(l,a)=>a+1),t=4;for(let l=0;l<e.length;l+=t){const a=e.slice(l,l+t),i=await Promise.allSettled(a.map(c=>$fetch("https://api.jikan.moe/v4/top/anime",{query:{filter:"bypopularity",limit:25,page:c}})));for(const c of i)c.status==="fulfilled"&&Z.push(...c.value.data)}Q=!0}function J(e=5,t=9){const l=Z.slice().sort(()=>Math.random()-.5);for(const a of l){const i=z(a),c=B(i);if(c.length>=e&&c.length<=t)return a}return null}async function ve(){var a,i;await q();const e=J();if(!e)throw new Error("No suitable anime found in top 200.");const t=z(e),l=B(t);x.value=t,d.value=l,m.value={image:O(e.images),synopsis:e.synopsis||null,year:e.year??null,type:e.type??null,studio:((i=(a=e.studios)==null?void 0:a[0])==null?void 0:i.name)??null,animeTitle:null}}async function fe(){var e,t;await q();for(let l=0;l<6;l++){const a=J(3,30);if(!a)break;const c=(await $fetch(`https://api.jikan.moe/v4/anime/${a.mal_id}/characters`)).data.map(n=>n.character).filter(Boolean).map(n=>({name:n.name,image:O(n.images)})).filter(n=>{const s=B(n.name);return s.length>=5&&s.length<=9});if(c.length){const n=c[Math.floor(Math.random()*c.length)];x.value=n.name,d.value=B(n.name),m.value={image:n.image||null,synopsis:null,year:a.year??null,type:a.type??null,studio:((t=(e=a.studios)==null?void 0:e[0])==null?void 0:t.name)??null,animeTitle:z(a)};return}}throw new Error("No suitable character found from top 200 anime.")}async function X(){A.value=!0,g.value=null;try{f.mode==="anime"?await ve():await fe(),ie($.value)}catch(e){g.value=(e==null?void 0:e.message)||"Failed to start game."}finally{A.value=!1}}function j(){X(),U()}const G=v(!1);me(()=>w.value,e=>{var t;e&&((t=m.value)!=null&&t.image)&&(G.value=!0)});const ee=()=>{G.value=!1};return pe(()=>{X(),window.addEventListener("keydown",P),U()}),ye(()=>{window.removeEventListener("keydown",P)}),(e,t)=>{var l,a,i,c;return r(),u("div",{class:"animedle",onClick:U},[Y(o("input",{ref_key:"hiddenEl",ref:I,"onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),class:"sr-only-input","aria-hidden":"true",autocomplete:"off",autocorrect:"off",autocapitalize:"characters",spellcheck:"false",onKeydown:ae,onInput:se},null,544),[[he,E.value]]),A.value?(r(),u("div",Ae,t[3]||(t[3]=[o("div",{class:"skeleton title"},null,-1),o("div",{class:"skeleton lines"},null,-1),o("div",{class:"skeleton image"},null,-1),o("div",{class:"skeleton lines"},null,-1)]))):g.value?(r(),u("div",$e,[o("div",null,_(g.value),1),o("button",{class:"btn",onClick:j},"Try Again")])):(r(),u("div",Ee,[o("div",Te,[o("div",xe,[t[4]||(t[4]=F("Mode: ")),o("strong",Ne,_(f.mode),1)]),o("div",Se,"Word length: "+_($.value),1),o("button",{class:"btn-outline",onClick:j},"New Target")]),(l=m.value)!=null&&l.image?(r(),u("div",Be,[o("img",{src:(a=m.value)==null?void 0:a.image,alt:"cover"},null,8,Le)])):M("",!0),o("div",Me,[(r(),u(b,null,C(K,n=>o("div",{key:n,class:"row"},[(r(!0),u(b,null,C($.value,s=>{var T;return r(),u("div",{key:s,class:R(["tile",(T=V.value[n-1])==null?void 0:T[s-1]])},_((y.value[n-1]||"")[s-1]||""),3)}),128))])),64))]),o("div",Re,[(r(!0),u(b,null,C(_e(oe),n=>(r(),u("div",{class:"kb-row",key:n},[n==="QWERTYUIOP"?(r(!0),u(b,{key:0},C(n.split(""),s=>(r(),u("button",{key:s,class:R(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,Ke))),128)):n==="ASDFGHJKL"?(r(!0),u(b,{key:1},C(n.split(""),s=>(r(),u("button",{key:s,class:R(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,Fe))),128)):(r(),u(b,{key:2},[o("button",{class:"key wide",onClick:t[1]||(t[1]=s=>h("ENTER"))},"ENTER"),(r(!0),u(b,null,C(n.split(""),s=>(r(),u("button",{key:s,class:R(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,Ve))),128)),o("button",{class:"key wide",onClick:t[2]||(t[2]=s=>h("BACKSPACE"))},"DEL")],64))]))),128))]),W.value.length?(r(),u("div",De,[(r(!0),u(b,null,C(W.value,(n,s)=>(r(),u("div",{key:s,class:"hint"},_(n),1))),128))])):M("",!0),w.value?(r(),u("div",Ue,[N.value?(r(),u("div",ze,"You got it!")):(r(),u("div",Pe,[t[5]||(t[5]=F("Answer: ")),o("strong",null,_(x.value),1)])),o("button",{class:"btn",onClick:j},"Play Again")])):M("",!0)])),G.value&&((i=m.value)!=null&&i.image)?(r(),u("div",{key:3,class:"img-modal",onClick:ge(ee,["self"])},[o("button",{class:"img-modal-close",onClick:ee,"aria-label":"Close"},"×"),o("img",{src:(c=m.value)==null?void 0:c.image,alt:"cover full",class:"img-modal-content"},null,8,je)])):M("",!0)])}}}),Ye=le(Ge,[["__scopeId","data-v-14ab2fb2"]]),He={class:"page-wrapper",style:{"max-width":"960px",margin:"0 auto"}},Ie={class:"controls",style:{display:"flex",gap:"1rem","align-items":"center","margin-bottom":"1rem"}},Oe={style:{display:"flex",gap:"0.4rem","align-items":"center"}},We={style:{display:"flex",gap:"0.4rem","align-items":"center"}},Ze=ne({__name:"animedle",setup(H){const f=v("anime"),A=v(0),g=()=>{A.value++};return(x,d)=>{const m=Ye,y=Ce;return r(),u("div",He,[d[4]||(d[4]=o("h1",{class:"text-3xl font-bold mb-4"},"Animedle",-1)),o("div",Ie,[o("label",Oe,[Y(o("input",{type:"radio",value:"anime","onUpdate:modelValue":d[0]||(d[0]=p=>f.value=p),onChange:g},null,544),[[te,f.value]]),d[2]||(d[2]=F(" Anime "))]),o("label",We,[Y(o("input",{type:"radio",value:"character","onUpdate:modelValue":d[1]||(d[1]=p=>f.value=p),onChange:g},null,544),[[te,f.value]]),d[3]||(d[3]=F(" Character "))]),o("button",{class:"btn",onClick:g},"New Game")]),ke(y,null,{default:we(()=>[(r(),be(m,{mode:f.value,key:f.value+":"+A.value},null,8,["mode"]))]),_:1})])}}}),Je=le(Ze,[["__scopeId","data-v-958e3fe7"]]);export{Je as default};
