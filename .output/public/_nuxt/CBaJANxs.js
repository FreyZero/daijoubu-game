import{e as ne,v,j as K,H as me,a4 as pe,a5 as ye,c as u,o as r,a2 as H,N as L,a3 as he,a as o,t as _,d as F,F as b,Q as C,K as M,n as _e,a6 as ge,_ as ae,b as ke,a7 as te,w as we,y as be}from"./cvlhs-y4.js";import{_ as Ce}from"./BDUOyUbU.js";const Ae={key:0,class:"card"},$e={key:1,class:"card error"},Ee={key:2,class:"card"},Te={class:"top"},xe={class:"mode"},Ne={style:{"text-transform":"capitalize"}},Se={class:"len"},Be={key:0,class:"image-wrap"},Ke=["src"],Le={class:"board"},Me={class:"keyboard"},Re=["onClick"],Fe=["onClick"],De=["onClick"],Ue={key:1,class:"hints"},Ve={key:2,class:"result"},ze={key:0,class:"ok"},Pe={key:1,class:"bad"},je=["src"],R=6,Ge=ne({__name:"AnimedleGame",props:{mode:{}},setup(I){const f=I,A=v(!0),g=v(null),x=v(""),d=v(""),m=v(null),y=v([]),p=v(0),D=v([]),k=v({}),w=v(!1),N=v(!1),U=v(0),Y=v(null),E=v("");function V(){requestAnimationFrame(()=>{var e;return(e=Y.value)==null?void 0:e.focus()})}function le(e){P(e),e.preventDefault(),e.stopPropagation(),E.value=""}function se(){const e=E.value.slice(-1).toUpperCase();/^[A-Z]$/.test(e)&&h(e),E.value=""}const oe="QWERTYUIOP ASDFGHJKL ZXCVBNM".split(" "),S=K(()=>U.value),$=K(()=>d.value.length);function z(e){var t,a,l,i;return((t=e.title_english)==null?void 0:t.trim())||((a=e.title)==null?void 0:a.trim())||((l=e.title_japanese)==null?void 0:l.trim())||((i=e.title)==null?void 0:i.trim())||""}function O(e){var t,a,l,i;return((t=e==null?void 0:e.jpg)==null?void 0:t.large_image_url)||((a=e==null?void 0:e.webp)==null?void 0:a.large_image_url)||((l=e==null?void 0:e.jpg)==null?void 0:l.large_large_image_url)||((i=e==null?void 0:e.webp)==null?void 0:i.large_large_image_url)||null}function B(e){return(e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/[A-Za-z]/g)||[]).join("").toUpperCase()}function ie(e){y.value=Array.from({length:R},()=>""),D.value=Array.from({length:R},()=>Array.from({length:e},()=>"")),U.value=0,p.value=0,k.value={},w.value=!1,N.value=!1}function re(e,t){const a=Array(t.length).fill("absent"),l=t.split(""),i=e.split(""),c={};for(const n of l)c[n]=(c[n]||0)+1;for(let n=0;n<l.length;n++)i[n]===l[n]&&(a[n]="correct",c[i[n]]--,i[n]="*");for(let n=0;n<l.length;n++){if(a[n]==="correct")continue;const s=i[n];s&&c[s]>0?(a[n]="present",c[s]--):a[n]="absent"}return a}function ue(e,t){for(let a=0;a<e.length;a++){const l=e[a],i=t[a],c=k.value[l];c?(c==="present"&&i==="correct"&&(k.value[l]="correct"),c==="absent"&&(i==="present"||i==="correct")&&(k.value[l]=i)):k.value[l]=i}}function h(e){if(!(w.value||!d.value)){if(e==="ENTER"){ce();return}if(e==="BACKSPACE"){if(p.value>0){const t=S.value,a=y.value[t]||"";y.value[t]=a.slice(0,-1),p.value--}return}if(/^[A-Z]$/.test(e)&&p.value<$.value){const t=S.value,a=y.value[t]||"";y.value[t]=(a+e).slice(0,$.value),p.value++}}}function ce(){if(w.value)return;const e=S.value,t=y.value[e]||"";if(t.length!==$.value)return;const a=re(t,d.value);if(D.value[e]=a,ue(t,a),t===d.value){N.value=!0,w.value=!0;return}if(e+1>=R){w.value=!0;return}U.value=e+1,p.value=0}function P(e){e.key==="Enter"?h("ENTER"):e.key==="Backspace"?h("BACKSPACE"):/^[a-z]$/i.test(e.key)&&h(e.key.toUpperCase())}const de=K(()=>{const e=S.value;return N.value||w.value||e>=5?3:e>=4?2:e>=2?1:0}),W=K(()=>{const e=m.value||{},t=[];return f.mode==="anime"?(e.type&&t.push(`Type: ${e.type}`),e.year&&t.push(`Year: ${e.year}`),e.studio&&t.push(`Studio: ${e.studio}`),e.synopsis&&t.push(`Synopsis: ${e.synopsis.slice(0,160)}…`)):(e.animeTitle&&t.push(`Anime: ${e.animeTitle}`),e.year&&t.push(`Anime Year: ${e.year}`),e.type&&t.push(`Anime Type: ${e.type}`)),t.slice(0,de.value)}),Z=[];let Q=!1;async function q(){if(Q)return;const e=Array.from({length:8},(a,l)=>l+1),t=4;for(let a=0;a<e.length;a+=t){const l=e.slice(a,a+t),i=await Promise.allSettled(l.map(c=>$fetch("https://api.jikan.moe/v4/top/anime",{query:{filter:"bypopularity",limit:25,page:c}})));for(const c of i)c.status==="fulfilled"&&Z.push(...c.value.data)}Q=!0}function J(e=5,t=9){const a=Z.slice().sort(()=>Math.random()-.5);for(const l of a){const i=z(l),c=B(i);if(c.length>=e&&c.length<=t)return l}return null}async function ve(){var l,i;await q();const e=J();if(!e)throw new Error("No suitable anime found in top 200.");const t=z(e),a=B(t);x.value=t,d.value=a,m.value={image:O(e.images),synopsis:e.synopsis||null,year:e.year??null,type:e.type??null,studio:((i=(l=e.studios)==null?void 0:l[0])==null?void 0:i.name)??null,animeTitle:null}}async function fe(){var e,t;await q();for(let a=0;a<6;a++){const l=J(3,30);if(!l)break;const c=(await $fetch(`https://api.jikan.moe/v4/anime/${l.mal_id}/characters`)).data.map(n=>n.character).filter(Boolean).map(n=>({name:n.name,image:O(n.images)})).filter(n=>{const s=B(n.name);return s.length>=5&&s.length<=9});if(c.length){const n=c[Math.floor(Math.random()*c.length)];x.value=n.name,d.value=B(n.name),m.value={image:n.image||null,synopsis:null,year:l.year??null,type:l.type??null,studio:((t=(e=l.studios)==null?void 0:e[0])==null?void 0:t.name)??null,animeTitle:z(l)};return}}throw new Error("No suitable character found from top 200 anime.")}async function X(){A.value=!0,g.value=null;try{f.mode==="anime"?await ve():await fe(),ie($.value)}catch(e){g.value=(e==null?void 0:e.message)||"Failed to start game."}finally{A.value=!1}}function j(){X(),V()}const G=v(!1);me(()=>w.value,e=>{var t;e&&((t=m.value)!=null&&t.image)&&(G.value=!0)});const ee=()=>{G.value=!1};return pe(()=>{X(),window.addEventListener("keydown",P),V()}),ye(()=>{window.removeEventListener("keydown",P)}),(e,t)=>{var a,l,i,c;return r(),u("div",{class:"animedle",onClick:V},[H(o("input",{ref_key:"hiddenEl",ref:Y,"onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),class:"sr-only-input","aria-hidden":"true",autocomplete:"off",autocorrect:"off",autocapitalize:"characters",spellcheck:"false",onKeydown:le,onInput:se},null,544),[[he,E.value]]),A.value?(r(),u("div",Ae,t[3]||(t[3]=[o("div",{class:"skeleton title"},null,-1),o("div",{class:"skeleton lines"},null,-1),o("div",{class:"skeleton image"},null,-1),o("div",{class:"skeleton lines"},null,-1)]))):g.value?(r(),u("div",$e,[o("div",null,_(g.value),1),o("button",{class:"btn",onClick:j},"Try Again")])):(r(),u("div",Ee,[o("div",Te,[o("div",xe,[t[4]||(t[4]=F("Mode: ")),o("strong",Ne,_(f.mode),1)]),o("div",Se,"Word length: "+_($.value),1),o("button",{class:"btn-outline",onClick:j},"New Target")]),(a=m.value)!=null&&a.image?(r(),u("div",Be,[o("img",{src:(l=m.value)==null?void 0:l.image,alt:"cover"},null,8,Ke)])):L("",!0),o("div",Le,[(r(),u(b,null,C(R,n=>o("div",{key:n,class:"row"},[(r(!0),u(b,null,C($.value,s=>{var T;return r(),u("div",{key:s,class:M(["tile",(T=D.value[n-1])==null?void 0:T[s-1]])},_((y.value[n-1]||"")[s-1]||""),3)}),128))])),64))]),o("div",Me,[(r(!0),u(b,null,C(_e(oe),n=>(r(),u("div",{class:"kb-row",key:n},[n==="QWERTYUIOP"?(r(!0),u(b,{key:0},C(n.split(""),s=>(r(),u("button",{key:s,class:M(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,Re))),128)):n==="ASDFGHJKL"?(r(!0),u(b,{key:1},C(n.split(""),s=>(r(),u("button",{key:s,class:M(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,Fe))),128)):(r(),u(b,{key:2},[o("button",{class:"key wide",onClick:t[1]||(t[1]=s=>h("ENTER"))},"ENTER"),(r(!0),u(b,null,C(n.split(""),s=>(r(),u("button",{key:s,class:M(["key",k.value[s]]),onClick:T=>h(s)},_(s),11,De))),128)),o("button",{class:"key wide",onClick:t[2]||(t[2]=s=>h("BACKSPACE"))},"DEL")],64))]))),128))]),W.value.length?(r(),u("div",Ue,[(r(!0),u(b,null,C(W.value,(n,s)=>(r(),u("div",{key:s,class:"hint"},_(n),1))),128))])):L("",!0),w.value?(r(),u("div",Ve,[N.value?(r(),u("div",ze,"You got it!")):(r(),u("div",Pe,[t[5]||(t[5]=F("Answer: ")),o("strong",null,_(x.value),1)])),o("button",{class:"btn",onClick:j},"Play Again")])):L("",!0)])),G.value&&((i=m.value)!=null&&i.image)?(r(),u("div",{key:3,class:"img-modal",onClick:ge(ee,["self"])},[o("button",{class:"img-modal-close",onClick:ee,"aria-label":"Close"},"×"),o("img",{src:(c=m.value)==null?void 0:c.image,alt:"cover full",class:"img-modal-content"},null,8,je)])):L("",!0)])}}}),He=ae(Ge,[["__scopeId","data-v-14ab2fb2"]]),Ie={class:"page-wrapper",style:{"max-width":"960px",margin:"0 auto"}},Ye={class:"controls",style:{display:"flex",gap:"1rem","align-items":"center","margin-bottom":"1rem"}},Oe={style:{display:"flex",gap:"0.4rem","align-items":"center"}},We={style:{display:"flex",gap:"0.4rem","align-items":"center"}},Ze=ne({__name:"animedle",setup(I){const f=v("anime"),A=v(0),g=()=>{A.value++};return(x,d)=>{const m=He,y=Ce;return r(),u("div",Ie,[d[4]||(d[4]=o("h1",{class:"text-3xl font-bold mb-4"},"Animedle",-1)),o("div",Ye,[o("label",Oe,[H(o("input",{type:"radio",value:"anime","onUpdate:modelValue":d[0]||(d[0]=p=>f.value=p),onChange:g},null,544),[[te,f.value]]),d[2]||(d[2]=F(" Anime "))]),o("label",We,[H(o("input",{type:"radio",value:"character","onUpdate:modelValue":d[1]||(d[1]=p=>f.value=p),onChange:g},null,544),[[te,f.value]]),d[3]||(d[3]=F(" Character "))]),o("button",{class:"btn",onClick:g},"New Game")]),ke(y,null,{default:we(()=>[(r(),be(m,{mode:f.value,key:f.value+":"+A.value},null,8,["mode"]))]),_:1})])}}}),Je=ae(Ze,[["__scopeId","data-v-958e3fe7"]]);export{Je as default};
